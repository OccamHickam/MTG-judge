<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veritas - Coach Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid #334155;
            margin-bottom: 30px;
        }
        .back-link {
            color: #14b8a6;
            text-decoration: none;
            font-size: 1.1rem;
        }
        .back-link:hover { text-decoration: underline; }
        
        h1 {
            font-size: 2rem;
            background: linear-gradient(90deg, #14b8a6, #2dd4bf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Stats Overview */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            border: 1px solid #334155;
            text-align: center;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #14b8a6;
        }
        .stat-label {
            color: #64748b;
            margin-top: 5px;
            font-size: 0.95rem;
        }
        
        /* Main Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        @media (max-width: 900px) {
            .dashboard { grid-template-columns: 1fr; }
        }
        
        /* Panels */
        .panel {
            background: #1e293b;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #334155;
        }
        .panel h2 {
            color: #14b8a6;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Voice Input Section */
        .voice-section {
            text-align: center;
            padding: 30px;
            background: #0f172a;
            border-radius: 12px;
            border: 2px dashed #334155;
            margin-bottom: 20px;
        }
        .voice-btn-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #14b8a6, #2dd4bf);
            border: none;
            cursor: pointer;
            font-size: 2.5rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(20, 184, 166, 0.3);
        }
        .voice-btn-large:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(20, 184, 166, 0.5);
        }
        .voice-btn-large.listening {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .voice-status {
            margin-top: 15px;
            color: #64748b;
            font-size: 0.95rem;
        }
        
        /* Advice Display */
        .advice-display {
            background: #0f172a;
            border-radius: 12px;
            padding: 20px;
            min-height: 200px;
            border: 1px solid #334155;
        }
        .advice-display.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
        }
        .advice-card {
            background: #1e293b;
            border-left: 4px solid #14b8a6;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .advice-card h3 {
            color: #14b8a6;
            margin-bottom: 10px;
        }
        .advice-card p {
            color: #94a3b8;
            line-height: 1.6;
            margin-bottom: 15px;
        }
        .advice-card ul {
            margin: 0;
            padding-left: 20px;
            color: #cbd5e1;
        }
        .advice-card li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        /* Session History */
        .session-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .session-item {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #334155;
            cursor: pointer;
            transition: all 0.2s;
        }
        .session-item:hover {
            border-color: #14b8a6;
        }
        .session-date {
            color: #64748b;
            font-size: 0.85rem;
        }
        .session-topic {
            color: #e2e8f0;
            margin-top: 5px;
        }
        .session-count {
            color: #14b8a6;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* Trends */
        .trend-chart {
            background: #0f172a;
            padding: 20px;
            border-radius: 8px;
            height: 200px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 10px;
        }
        .trend-bar {
            flex: 1;
            background: linear-gradient(to top, #14b8a6, #2dd4bf);
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            position: relative;
        }
        .trend-bar::after {
            content: attr(data-label);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: #64748b;
            white-space: nowrap;
        }
        
        /* Text Input Alternative */
        .text-input-alt {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        .text-input-alt input {
            flex: 1;
            padding: 12px;
            background: #0f172a;
            border: 2px solid #334155;
            border-radius: 6px;
            color: #e2e8f0;
            font-size: 1rem;
        }
        .text-input-alt input:focus {
            outline: none;
            border-color: #14b8a6;
        }
        button {
            background: linear-gradient(90deg, #14b8a6, #2dd4bf);
            color: #0f172a;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4);
        }
        button.secondary {
            background: #334155;
            color: #e2e8f0;
        }
        
        /* Full Width Sections */
        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-link">‚Üê Back to Home</a>
            <h1>üß† Coach Dashboard</h1>
            <div style="width: 100px;"></div>
        </header>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalSessions">0</div>
                <div class="stat-label">Coaching Sessions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalQuestions">0</div>
                <div class="stat-label">Questions Asked</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTime">0h</div>
                <div class="stat-label">Total Coaching Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topTopic">-</div>
                <div class="stat-label">Most Discussed Topic</div>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="dashboard">
            <!-- Left: Active Coaching -->
            <div class="panel">
                <h2>üé§ Ask for Coaching</h2>
                
                <div class="voice-section">
                    <button class="voice-btn-large" id="voiceBtn" onclick="toggleVoice()">üéôÔ∏è</button>
                    <div class="voice-status" id="voiceStatus">Tap microphone to speak</div>
                </div>
                
                <div class="text-input-alt">
                    <input type="text" id="textInput" placeholder="Or type your question... (e.g., 'Should I attack with everything?')">
                    <button onclick="submitText()">Ask</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3 style="color: #14b8a6; margin-bottom: 15px; font-size: 1rem;">Current Advice</h3>
                    <div class="advice-display empty" id="adviceDisplay">
                        <span>Your coaching advice will appear here...</span>
                    </div>
                </div>
            </div>

            <!-- Right: Session History -->
            <div class="panel">
                <h2>üìö Recent Sessions</h2>
                <div class="session-list" id="sessionList">
                    <p style="color: #64748b; text-align: center; padding: 40px;">No coaching sessions yet. Start by asking a question!</p>
                </div>
            </div>

            <!-- Bottom: Topic Trends -->
            <div class="panel full-width">
                <h2>üìä Your Coaching Trends</h2>
                <div class="trend-chart" id="trendChart">
                    <div class="trend-bar" style="height: 40%;" data-label="Combat"></div>
                    <div class="trend-bar" style="height: 60%;" data-label="Resources"></div>
                    <div class="trend-bar" style="height: 30%;" data-label="Planning"></div>
                    <div class="trend-bar" style="height: 80%;" data-label="Trading"></div>
                    <div class="trend-bar" style="height: 50%;" data-label="Tempo"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let recognition = null;
        let isListening = false;
        let currentSession = {
            questions: [],
            startTime: new Date()
        };

        // Load historical data
        let allSessions = JSON.parse(localStorage.getItem('veritas_coaching') || '[]');
        updateStats();
        renderSessionList();

        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                processQuestion(transcript);
                stopVoice();
            };

            recognition.onerror = () => stopVoice();
            recognition.onend = () => stopVoice();
        }

        function toggleVoice() {
            if (!recognition) {
                alert('Voice recognition not supported. Use Chrome or Edge.');
                return;
            }

            const btn = document.getElementById('voiceBtn');
            const status = document.getElementById('voiceStatus');

            if (isListening) {
                recognition.stop();
                stopVoice();
            } else {
                recognition.start();
                isListening = true;
                btn.classList.add('listening');
                status.textContent = 'Listening... speak your question';
                status.style.color = '#ef4444';
            }
        }

        function stopVoice() {
            isListening = false;
            document.getElementById('voiceBtn').classList.remove('listening');
            document.getElementById('voiceStatus').textContent = 'Tap microphone to speak';
            document.getElementById('voiceStatus').style.color = '#64748b';
        }

        function submitText() {
            const input = document.getElementById('textInput');
            const question = input.value.trim();
            if (!question) return;
            processQuestion(question);
            input.value = '';
        }

        function processQuestion(question) {
            const advice = generateAdvice(question);
            
            // Add to current session
            currentSession.questions.push({
                text: question,
                advice: advice,
                time: new Date().toISOString()
            });

            // Display advice
            displayAdvice(advice);
            
            // Save session data
            saveSession();
            
            // Update UI
            updateStats();
            renderSessionList();
        }

        function generateAdvice(question) {
            const lower = question.toLowerCase();
            
            // Determine topic and generate specific advice
            if (lower.includes('attack') || lower.includes('swing') || lower.includes('combat')) {
                return {
                    topic: 'Combat',
                    title: '‚öîÔ∏è Combat Decision',
                    summary: 'Consider blockers, removal, and your role (beatdown vs control).',
                    details: [
                        'Count potential blockers vs your attackers',
                        'Do they have mana open for combat tricks?',
                        'If blocked optimally, do you win or lose the trade?',
                        'Are you the aggressor? If ahead, force trades. If behind, be cautious.'
                    ]
                };
            }
            
            if (lower.includes('block')) {
                return {
                    topic: 'Combat',
                    title: 'üõ°Ô∏è Blocking Strategy',
                    summary: 'Trade efficiently or preserve key creatures.',
                    details: [
                        'Trade your weaker creatures for their stronger ones',
                        'Don\'t chump block unless necessary ‚Äî life is a resource',
                        'Preserve creatures with evasion or high long-term value',
                        'Consider: "Will I need this blocker on a future turn?"'
                    ]
                };
            }
            
            if (lower.includes('trade')) {
                return {
                    topic: 'Trading',
                    title: '‚öñÔ∏è Resource Trading',
                    summary: 'Trade when your card is worse, or when ahead to reduce variance.',
                    details: [
                        'Trade up: your 2/2 for their 3/3 is profitable',
                        'When ahead, trade to simplify. When behind, avoid trades and seek 2-for-1s',
                        'Consider cards remaining in deck ‚Äî who has more quality left?',
                        'Don\'t trade your only answer to their big threat'
                    ]
                };
            }
            
            if (lower.includes('mana') || lower.includes('cards') || lower.includes('resources')) {
                return {
                    topic: 'Resources',
                    title: 'üìä Resource Management',
                    summary: 'Track cards, life, and mana. Who has more total resources?',
                    details: [
                        'Card advantage: Who will run out of playable spells first?',
                        'Tempo: Who is dictating the pace of play?',
                        'Mana efficiency: Are you using all your mana each turn?',
                        'Life total: Is it a resource to spend or must be protected?'
                    ]
                };
            }
            
            if (lower.includes('plan') || lower.includes('strategy') || lower.includes('win')) {
                return {
                    topic: 'Planning',
                    title: 'üéØ Strategic Planning',
                    summary: 'Identify your win condition and play toward it.',
                    details: [
                        'What is your path to victory? (Aggro, combo, value, control)',
                        'Are you the beatdown or the control deck in this matchup?',
                        'Sequence plays to maximize pressure or disruption',
                        'Anticipate their responses and have backup plans'
                    ]
                };
            }
            
            if (lower.includes('ahead') || lower.includes('winning') || lower.includes('lead')) {
                return {
                    topic: 'Tempo',
                    title: 'üèÜ Playing From Ahead',
                    summary: 'Protect your advantage. Force trades and reduce variance.',
                    details: [
                        'Don\'t get greedy ‚Äî secure the win methodically',
                        'Force trades to reduce their comeback potential',
                        'Hold removal for their best threats only',
                        'Watch for board wipes ‚Äî don\'t overextend into sweepers'
                    ]
                };
            }
            
            if (lower.includes('behind') || lower.includes('losing') || lower.includes('catch')) {
                return {
                    topic: 'Tempo',
                    title: 'üîÑ Playing From Behind',
                    summary: 'Take calculated risks. Play to your outs.',
                    details: [
                        'Seek 2-for-1s or card advantage to catch up',
                        'Play to specific outs (topdeck threats, synergies)',
                        'Bluff confidence ‚Äî pressure their decisions',
                        'Consider unconventional lines they won\'t expect'
                    ]
                };
            }
            
            // Default
            return {
                topic: 'General',
                title: 'üß† Strategic Analysis',
                summary: 'Assess the game state and identify the critical decision.',
                details: [
                    'Resources: Compare life, cards, board state, and mana',
                    'Role: Determine if you\'re beatdown or control',
                    'Plan: What sequence maximizes your win probability?',
                    'Adapt: New information should update your strategy'
                ]
            };
        }

        function displayAdvice(advice) {
            const display = document.getElementById('adviceDisplay');
            display.classList.remove('empty');
            
            display.innerHTML = `
                <div class="advice-card">
                    <h3>${advice.title}</h3>
                    <p>${advice.summary}</p>
                    <ul>
                        ${advice.details.map(d => `<li>${d}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function saveSession() {
            // Update or create session in storage
            let sessions = JSON.parse(localStorage.getItem('veritas_coaching') || '[]');
            
            // Check if we have an active session from today
            const today = new Date().toDateString();
            const existingIndex = sessions.findIndex(s => 
                new Date(s.startTime).toDateString() === today && !s.endTime
            );
            
            if (existingIndex >= 0) {
                sessions[existingIndex] = {
                    ...sessions[existingIndex],
                    questions: currentSession.questions,
                    endTime: new Date().toISOString()
                };
            } else {
                sessions.push({
                    ...currentSession,
                    endTime: new Date().toISOString()
                });
            }
            
            localStorage.setItem('veritas_coaching', JSON.stringify(sessions));
            allSessions = sessions;
        }

        function updateStats() {
            document.getElementById('totalSessions').textContent = allSessions.length;
            
            const totalQuestions = allSessions.reduce((sum, s) => sum + (s.questions?.length || 0), 0);
            document.getElementById('totalQuestions').textContent = totalQuestions;
            
            const totalMinutes = allSessions.reduce((sum, s) => {
                if (s.startTime && s.endTime) {
                    return sum + Math.floor((new Date(s.endTime) - new Date(s.startTime)) / 60000);
                }
                return sum;
            }, 0);
            document.getElementById('totalTime').textContent = totalMinutes + 'm';
            
            // Find top topic
            const topicCounts = {};
            allSessions.forEach(s => {
                s.questions?.forEach(q => {
                    topicCounts[q.advice?.topic] = (topicCounts[q.advice?.topic] || 0) + 1;
                });
            });
            const topTopic = Object.entries(topicCounts).sort((a, b) => b[1] - a[1])[0];
            document.getElementById('topTopic').textContent = topTopic ? topTopic[0] : '-';
        }

        function renderSessionList() {
            const list = document.getElementById('sessionList');
            
            if (allSessions.length === 0) {
                list.innerHTML = '<p style="color: #64748b; text-align: center; padding: 40px;">No coaching sessions yet. Start by asking a question!</p>';
                return;
            }
            
            // Sort by date, newest first
            const sorted = [...allSessions].reverse().slice(0, 10);
            
            list.innerHTML = sorted.map(session => {
                const date = new Date(session.startTime);
                const dateStr = date.toLocaleDateString();
                const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const questionCount = session.questions?.length || 0;
                const topics = [...new Set(session.questions?.map(q => q.advice?.topic).filter(Boolean))].join(', ');
                
                return `
                    <div class="session-item" onclick="loadSession('${session.startTime}')">
                        <div class="session-date">${dateStr} at ${timeStr}</div>
                        <div class="session-topic">${topics || 'General coaching'}</div>
                        <div class="session-count">${questionCount} question${questionCount !== 1 ? 's' : ''}</div>
                    </div>
                `;
            }).join('');
        }

        function loadSession(startTime) {
            const session = allSessions.find(s => s.startTime === startTime);
            if (!session || !session.questions?.length) return;
            
            // Show the last question from that session
            const lastQ = session.questions[session.questions.length - 1];
            displayAdvice(lastQ.advice);
            
            // Scroll to advice
            document.getElementById('adviceDisplay').scrollIntoView({ behavior: 'smooth' });
        }

        // Handle Enter key
        document.getElementById('textInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitText();
        });
    </script>
</body>
</html>
