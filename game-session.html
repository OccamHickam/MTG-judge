<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Veritas - Game Session</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Particle Background */
        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(0, 167, 181, 0.3);
            margin-bottom: 30px;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #00a7b5, #c9a86a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #4a5568;
            font-size: 1.1rem;
        }

        /* Main Game Interface */
        .game-interface {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .game-interface {
                grid-template-columns: 1fr;
            }
        }

        /* Voice Activation Section */
        .voice-section {
            background: rgba(10, 26, 47, 0.8);
            border: 1px solid rgba(0, 167, 181, 0.3);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 3px solid #00a7b5;
            background: rgba(0, 167, 181, 0.1);
            color: #00a7b5;
            font-size: 3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .mic-button:hover {
            background: rgba(0, 167, 181, 0.2);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 167, 181, 0.4);
        }

        .mic-button.listening {
            background: rgba(0, 167, 181, 0.3);
            animation: pulse 1.5s infinite;
            color: #c9a86a;
            border-color: #c9a86a;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(0, 167, 181, 0.7); }
            50% { box-shadow: 0 0 0 20px rgba(0, 167, 181, 0); }
        }

        .mic-status {
            font-size: 0.9rem;
            color: #4a5568;
            margin-top: 10px;
        }

        .voice-hints {
            margin-top: 20px;
            text-align: left;
            font-size: 0.85rem;
            color: #6b7280;
        }

        .voice-hints li {
            margin: 8px 0;
            list-style: none;
            padding-left: 20px;
            position: relative;
        }

        .voice-hints li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #00a7b5;
        }

        /* Answer Plate - Center Stage */
        .answer-plate {
            background: rgba(10, 26, 47, 0.9);
            border: 2px solid rgba(201, 168, 106, 0.3);
            border-radius: 20px;
            padding: 40px;
            min-height: 500px;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }

        .answer-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(201, 168, 106, 0.2);
        }

        .answer-header h2 {
            color: #c9a86a;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .card-context {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .card-image {
            width: 80px;
            height: 112px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid rgba(201, 168, 106, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .card-name {
            font-size: 1.2rem;
            color: #e0e0e0;
            font-weight: 600;
        }

        .answer-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .answer-section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #00a7b5;
        }

        .answer-section.explanation {
            border-left-color: #c9a86a;
        }

        .answer-section.action {
            border-left-color: #10b981;
        }

        .section-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #4a5568;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .section-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #e0e0e0;
        }

        .oracle-text {
            font-style: italic;
            color: #9ca3af;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .placeholder-state {
            text-align: center;
            color: #4a5568;
            padding: 60px 20px;
        }

        .placeholder-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Game Log Sidebar */
        .game-log {
            background: rgba(10, 26, 47, 0.8);
            border: 1px solid rgba(0, 167, 181, 0.3);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(10px);
            max-height: 600px;
            overflow-y: auto;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 167, 181, 0.2);
        }

        .log-header h3 {
            color: #00a7b5;
            font-size: 1.1rem;
        }

        .clear-log {
            background: none;
            border: none;
            color: #4a5568;
            cursor: pointer;
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .clear-log:hover {
            color: #c9a86a;
        }

        .log-entry {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 3px solid #00a7b5;
            transition: all 0.2s;
        }

        .log-entry:hover {
            background: rgba(0, 0, 0, 0.3);
            transform: translateX(5px);
        }

        .log-entry .timestamp {
            font-size: 0.7rem;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .log-entry .query {
            font-weight: 600;
            color: #e0e0e0;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .log-entry .response-summary {
            font-size: 0.85rem;
            color: #9ca3af;
            line-height: 1.4;
        }

        .empty-log {
            text-align: center;
            color: #4a5568;
            padding: 40px 20px;
            font-style: italic;
        }

        /* Quick Actions Bar */
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
            padding: 20px;
            background: rgba(10, 26, 47, 0.6);
            border-radius: 12px;
            border: 1px solid rgba(0, 167, 181, 0.2);
        }

        .quick-btn {
            background: rgba(0, 167, 181, 0.1);
            border: 1px solid rgba(0, 167, 181, 0.3);
            color: #00a7b5;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: rgba(0, 167, 181, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 167, 181, 0.2);
        }

        /* Manual Input Fallback */
        .manual-input {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .manual-input input {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 167, 181, 0.3);
            color: #e0e0e0;
            padding: 12px 20px;
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
        }

        .manual-input input:focus {
            border-color: #00a7b5;
            box-shadow: 0 0 0 3px rgba(0, 167, 181, 0.1);
        }

        .manual-input button {
            background: #00a7b5;
            border: none;
            color: #0a0a0f;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .manual-input button:hover {
            background: #c9a86a;
            transform: scale(1.05);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 167, 181, 0.3);
            border-top-color: #00a7b5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo { font-size: 2rem; }
            .answer-plate { padding: 25px; min-height: 400px; }
            .mic-button { width: 100px; height: 100px; font-size: 2.5rem; }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 167, 181, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 167, 181, 0.7);
        }
    </style>
</head>
<body>
    <canvas id="particles-canvas"></canvas>

    <div class="container">
        <header class="header">
            <h1 class="logo">Veritas</h1>
            <p class="subtitle">Game Session Active</p>
        </header>

        <div class="game-interface">
            <!-- Left: Voice Control -->
            <div class="voice-section">
                <h3 style="color: #00a7b5; margin-bottom: 10px;">Voice Assistant</h3>
                <button class="mic-button" id="micBtn" onclick="toggleListening()">
                    üé§
                </button>
                <p class="mic-status" id="micStatus">Tap to start listening</p>
                
                <ul class="voice-hints">
                    <li>"What does Doubling Season do?"</li>
                    <li>"How does the stack work?"</li>
                    <li>"Can I counter a triggered ability?"</li>
                    <li>"What's the power of my commander?"</li>
                </ul>

                <div class="manual-input">
                    <input type="text" id="manualInput" placeholder="Or type your question..." onkeypress="if(event.key==='Enter')handleManualInput()">
                    <button onclick="handleManualInput()">Ask</button>
                </div>
            </div>

            <!-- Center: Answer Plate -->
            <div class="answer-plate" id="answerPlate">
                <div class="placeholder-state" id="placeholder">
                    <div class="icon">üé≤</div>
                    <h3>Ask a Rules Question</h3>
                    <p>Use voice or type to get instant answers</p>
                </div>
                
                <div class="answer-header" id="answerHeader" style="display: none;">
                    <h2>Rules Clarification</h2>
                    <div class="card-context" id="cardContext"></div>
                </div>

                <div class="answer-content" id="answerContent" style="display: none;">
                    <div class="answer-section">
                        <div class="section-label">The Rule</div>
                        <div class="section-content" id="ruleContent"></div>
                        <div class="oracle-text" id="oracleText" style="display: none;"></div>
                    </div>

                    <div class="answer-section explanation">
                        <div class="section-label">Explanation</div>
                        <div class="section-content" id="explanationContent"></div>
                    </div>

                    <div class="answer-section action">
                        <div class="section-label">What To Do</div>
                        <div class="section-content" id="actionContent"></div>
                    </div>
                </div>

                <div class="loading" id="loadingState" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Consulting the archives...</p>
                </div>
            </div>

            <!-- Right: Game Log -->
            <div class="game-log">
                <div class="log-header">
                    <h3>Session Log</h3>
                    <button class="clear-log" onclick="clearLog()">Clear</button>
                </div>
                <div id="logContainer">
                    <div class="empty-log">No questions yet</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <button class="quick-btn" onclick="quickAsk('What is the combat phase order?')">Combat Phase</button>
            <button class="quick-btn" onclick="quickAsk('How does priority work?')">Priority</button>
            <button class="quick-btn" onclick="quickAsk('What is the commander tax?')">Commander Tax</button>
            <button class="quick-btn" onclick="quickAsk('How do state-based actions work?')">State-Based</button>
            <button class="quick-btn" onclick="quickAsk('What is the difference between activated and triggered abilities?')">Abilities</button>
        </div>
    </div>

    <script>
        // Particle Background Animation
        const canvas = document.getElementById('particles-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        class Particle {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 3 + 1;
                this.speedX = Math.random() * 0.5 - 0.25;
                this.speedY = Math.random() * 0.5 - 0.25;
                this.color = Math.random() > 0.5 ? 'rgba(0, 167, 181, 0.3)' : 'rgba(201, 168, 106, 0.2)';
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                if (this.x > canvas.width) this.x = 0;
                if (this.x < 0) this.x = canvas.width;
                if (this.y > canvas.height) this.y = 0;
                if (this.y < 0) this.y = canvas.height;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < 50; i++) {
                particles.push(new Particle());
            }
        }
        initParticles();

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        // Speech Recognition
        let recognition = null;
        let isListening = false;

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                document.getElementById('micBtn').classList.add('listening');
                document.getElementById('micStatus').textContent = 'Listening...';
            };

            recognition.onend = () => {
                isListening = false;
                document.getElementById('micBtn').classList.remove('listening');
                document.getElementById('micStatus').textContent = 'Tap to start listening';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                processQuery(transcript);
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById('micStatus').textContent = 'Error: ' + event.error;
                setTimeout(() => {
                    document.getElementById('micStatus').textContent = 'Tap to start listening';
                }, 3000);
            };
        }

        function toggleListening() {
            if (!recognition) {
                alert('Speech recognition not supported in this browser. Please use Chrome or Edge.');
                return;
            }
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function handleManualInput() {
            const input = document.getElementById('manualInput');
            const query = input.value.trim();
            if (query) {
                processQuery(query);
                input.value = '';
            }
        }

        function quickAsk(question) {
            processQuery(question);
        }

        // Mock API Call - Replace with your Railway backend
        async function processQuery(query) {
            showLoading();
            
            // Add to log immediately
            addToLog(query, 'Processing...');
            
            try {
                // TODO: Replace with your Railway backend URL
                // const response = await fetch('https://your-railway-app.up.railway.app/api/rules', {
                //     method: 'POST',
                //     headers: { 'Content-Type': 'application/json' },
                //     body: JSON.stringify({ query })
                // });
                // const data = await response.json();
                
                // Mock response for now
                await new Promise(resolve => setTimeout(resolve, 1500));
                const data = generateMockResponse(query);
                
                displayAnswer(data);
                updateLastLogEntry(query, data.summary || 'Answer provided');
                
            } catch (error) {
                console.error('Error:', error);
                displayError('Failed to get answer. Please try again.');
            }
        }

        function generateMockResponse(query) {
            // Mock data - replace with real API response
            return {
                hasCard: query.toLowerCase().includes('doubling season') || query.toLowerCase().includes('card'),
                cardName: query.toLowerCase().includes('doubling season') ? 'Doubling Season' : 'Example Card',
                cardImage: 'https://cards.scryfall.io/normal/front/5/2/520cbcb6-062e-4ebc-8f44-92ee3e89c0e0.jpg',
                rule: 'If an effect would create one or more tokens under your control, it creates twice that many of those tokens instead. If an effect would put one or more counters on a permanent you control, it puts twice that many of those counters on that permanent instead.',
                oracleText: 'If an effect would create one or more tokens under your control, it creates twice that many of those tokens instead.\nIf an effect would put one or more counters on a permanent you control, it puts twice that many of those counters on that permanent instead.',
                explanation: 'Doubling Season is a replacement effect that doubles tokens and counters. It applies to all effects that create tokens or place counters, including your opponents\' effects if they affect your permanents.',
                action: 'When Doubling Season is on the battlefield, any token creation or counter placement is automatically doubled. No additional action is required. Remember this affects all players\' effects that target your permanents.',
                summary: 'Doubles tokens and counters'
            };
        }

        function showLoading() {
            document.getElementById('placeholder').style.display = 'none';
            document.getElementById('answerHeader').style.display = 'none';
            document.getElementById('answerContent').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';
        }

        function displayAnswer(data) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('answerHeader').style.display = 'block';
            document.getElementById('answerContent').style.display = 'flex';

            const cardContext = document.getElementById('cardContext');
            if (data.hasCard && data.cardImage) {
                cardContext.innerHTML = `
                    <img src="${data.cardImage}" alt="${data.cardName}" class="card-image" onerror="this.style.display='none'">
                    <span class="card-name">${data.cardName}</span>
                `;
            } else {
                cardContext.innerHTML = '<span class="card-name">General Rules Question</span>';
            }

            document.getElementById('ruleContent').textContent = data.rule || 'No specific rule found.';
            
            const oracleDiv = document.getElementById('oracleText');
            if (data.oracleText) {
                oracleDiv.textContent = data.oracleText;
                oracleDiv.style.display = 'block';
            } else {
                oracleDiv.style.display = 'none';
            }

            document.getElementById('explanationContent').textContent = data.explanation || 'No explanation available.';
            document.getElementById('actionContent').textContent = data.action || 'No specific action required.';
        }

        function displayError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('placeholder').style.display = 'block';
            document.getElementById('placeholder').innerHTML = `
                <div class="icon">‚ö†Ô∏è</div>
                <h3>Error</h3>
                <p>${message}</p>
            `;
        }

        // Game Log Functions
        let logEntries = [];

        function addToLog(query, response) {
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const entry = { timestamp, query, response };
            logEntries.unshift(entry);
            renderLog();
        }

        function updateLastLogEntry(query, response) {
            if (logEntries.length > 0 && logEntries[0].query === query) {
                logEntries[0].response = response;
                renderLog();
            }
        }

        function renderLog() {
            const container = document.getElementById('logContainer');
            if (logEntries.length === 0) {
                container.innerHTML = '<div class="empty-log">No questions yet</div>';
                return;
            }

            container.innerHTML = logEntries.map(entry => `
                <div class="log-entry">
                    <div class="timestamp">${entry.timestamp}</div>
                    <div class="query">${escapeHtml(entry.query)}</div>
                    <div class="response-summary">${escapeHtml(entry.response)}</div>
                </div>
            `).join('');
        }

        function clearLog() {
            logEntries = [];
            renderLog();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
                toggleListening();
            }
        });
    </script>
</body>
</html>
